経済システムの大改造
POPにもとづく経済出力と資源算出。

############ステート管理advaced＋POP＋Civilian_Economy+Trade#################
MOD目標
popなどを基にしたstate経済システムを構築する。


########################バニラゲーム分析・Modding補足

バニラ版のstateステータス
vp　勝利点。（provinceベース。政治的価値）
core, claim, non_core　保有の正当性
natural_resources　問答無用でわいてくる資源
population　人口
state_category　スロット数基本値を決める。
buiding_level　建築物のかず。政府が把握している工業力ベース。
　インフラ
　民需
　軍需
　造船
　軍事基地（レーダー、飛行場、対空砲）
　港、要塞、沿岸要塞

#modding用に使えるアイデアなど
確実に使えるmodifier
local_resources
local_manpower
local_non_core_manpower
local_factories：dockyardとfactoryの数を増減する。増減は最終的な工場数にのみ反映され、スロットには現れない。
local_building_slots_factor
使えるかもしれないmodifier
resistance_tick
local_supplies
local_intel_to_enemies
local_factory_sabotage
attrition
local_building_slots
effects, local_manpower
つかえたらいいなあmodifier
local_monthly_population

チャートはmoddingでは使えないのでパーセントのリストでがんばる。
工場の量はステートごとに効率が変えられる。建設数が少なくとも、local_factoryのmodifierで工場数を増やせる。
国家レベルではfactory_outputが役にタツ。
インフラは次第に壊れるように想定する。壊れる率を場所ごとに変える。
軍事工場は、すべて国家管理のものと仮定、コストはすべて国が支払う。
工場の量はステートごとに効率が変わる。建設数が少なくとも、local_factoryのmodifierで工場数を増やせる。
国家レベルではfactory_outputが役に立つ。


########################コンセプト再構成・アイデア

＃coreとnon_coreの違い。
そのstateの住民がcore国に属するという自認と、そのstateがcore国に属するという国際的評価を示す。
non_core_stateは、stateの人々も国際社会も保有国の一部だとは認識してない。

＃state_category
スロット数基本値、開発可能限界を決める。現地の民間経済価値の基本値の一つをなす。
ステートの発展具合を示す指標の一つだが、スロット数はあくまでスロット数。

#building
実際のICを提供する。政府の把握している工業力ベースと考えられる。
バランスとしては、stateごとに稼働可能なfactoryの限界値があり、それを超えるとlocal_factoryやlocal_resourcesが低下していく。
十分なバックグラウンドというのは、民間の経済力に依存し、国の経済力にはあまり依存しない。
高い消費財と多くの発展した土地が民間経済力の基礎となる。


#######################ToDoリスト####################

＃工業出力メカニクス
　工場と労働者による工業生産
　農民による工業生産

＃投資メカニクス
　投資ポイントによるランダム開発、ボーナス
　消費財消費と投資家POPにもとづく投資ポイントの算出

＃POPの共通ステータス定義
　人口
　職業
　国籍
　市民権
　生産性（生産力）
　充足度　＝　必要コスト（消費財、そのほかポイント）/ 維持コスト（消費財、そのほかポイント）
　国家忠誠度

＃ステートの新規ステータス定義
　工場工業出力
　農民工業出力
　国家統合度

＃POPステータスそのものの変化メカニクス
　POPの職業移転、移住、人口変化、国籍変化
　生産性変化
　充足度計算＝必要コスト変化、維持コスト変化
　国家忠誠度計算＝充足度、国籍、市民権、格差

＃新規ステートステータスの変化メカニクス
　工業出力補正　＝　基本的にPOPステータスに依存
　国家統合度　＝　POPの割合などに依存
　不穏度　＝　POPの国家忠誠度などに依存

############POP定義####################

＃Population
人口　popsの影響範囲。徴兵、州経済、政治に影響

POP分類

農民（わずかな工業出力。労働者のプールを形成できる。）（ステートPOP）
労働者（工場で働き大量の工業力を出力。）（ステートPOP）
自営業者（労働者の消費財、農民の消費財、市場に出回るもので生活する。工業力は出力しないが非工場労働者としてもろもろ貢献。）（ステートPOP）
公務員（政府支出によって生活する。自営業者のうち、収入が政府依存のもの。工業力はあまり出力しないが経済、政府効率に貢献。）（ステートPOP）
投資家（消費財を吸い上げて投資ポイントへと変換して投資を行う。各種ボーナスイベントを発生させる。）（国家POP）

各職業ごとにさらにnationalityに分類

各POPは以下のstatsを持つ

citizenship 市民権ランク
満足度　職業変更可能性や生産性に影響。
生産性　生産性。出力に影響
国力統合度　POPがどれだけ国力に統合されているかを示す。強制労働や徴兵、農民出力に影響
忠誠度　国家に対する反逆度。レジスタンス

これによって何を可能としたい？
人は多いが生産性はくそ
人は多いが全然活用できない
一流市民が二流紙民を、二流市民が三流市民を抑圧
政府にコントロールされているが反逆度は高い
満足度は高いがだが生産性は低い
生産性はくそだが政府コントロールはしっかり（ソ連の徴兵など）


############POPメカニクス#################労働者####################

十分なPOPと工場がそろって初めて工業出力を算出する。工場へ政府管理度の影響はなく、常に完全コントロール下にある。

労働者POPには生産性が存在し、生産性は労働者雇用コスト（一人当たり雇用コスト）や労働者生産性（一人当たり工業出力）を左右する。
ステート工場数と工場当たり最大雇用力によってステート労働者雇用枠が決定される。
ステート工場数は建設で、工場当たり最大雇用力は研究やそのほか補正で決定される。
労働者コストは労働者の生産性に依存し、ステート労働者雇用枠が許す限り労働者は自動的に工場に割り当てられていく。
工場雇用労働者数と労働者の生産性によってステート工業出力の基本値が決定される。

ステート工業出力基本値　＝　雇用労働者数＊労働者生産性
ステート労働者雇用枠　＝　ステート工場数＊工場当たり雇用力
ステート雇用労働者数＝MIN（ステート総労働者数 or ステート労働者雇用枠）
労働者がいる限り工場は増やせるが、労働者がいなくなると強力なペナルティを受けて建設してもステート工場出力は上昇しなくなる。
また、ステート労働者雇用枠は消費財に直結するが、基本的に上げ下げは不可能。

労働者には維持消費財工業力が必要である。稼働している工場については、
ステート雇用労働者コスト＝　ステート雇用労働者数　＊　雇用労働者コスト
が必要である。
また、非稼働工場および無色の労働者については
ステート労働者雇用枠　＝　ステート工場数＊工場当たり雇用力
に対して
余剰労働者収支　＝　ステート総労働者数-ステート労働者雇用枠
が得られる。
余剰労働者収支が+の時、人手余剰であり、
余剰労働者収支が-の時、人手不足である。
余剰労働者に対して余剰労働者コストをかけることができ、人手不足の時のコストはボーナス賃金、人手余剰の時のコストは失業手当に該当する。
ボーナス賃金と失業手当は各種の法律と補正に影響されるが、雇用労働者コストの何割かを設定する。

最終的にステートの工場と労働者のために必要なコストは、
ステートPOP維持コスト　＝　余剰労働者収支＊余剰労働者コスト＋ステート雇用労働者数＊雇用労働者コスト
となり、これは消費財にふくまれる。

労働者POPには富裕度があり、これはステートのPOPの必要コストとステートのPOP維持コストの比率に関係する
ステートPOP必要コスト　＝　ステート総労働者数　＊　雇用労働者コスト
ステートPOP維持コスト　＝　余剰労働者収支＊余剰労働者コスト＋ステート雇用労働者数＊雇用労働者コスト
について、必要コスト/維持コストでPOPの満足度が決定される。
労働者の場合、貧困なら生産性低下が発生し、満足なら生産性上昇が発生する。

資源についても同様で、地域の基礎資源値に対して、労働力雇用力が定まり、雇い入れられるだけ雇い入れる。人が足りないと出力低下。
ほかの特殊な建物についても同様のメカニクスを導入。
ただし、資源の場合労働者雇用力は基礎資源量に完全に依存し、工場のように基礎値を上げることが基本的にできない。
また、工業力を生産しないので民需工場を食べるだけの存在。
出力を上げるためには生産性、技術開発、インフラ投資となる。
軍事工場及び造船所も同様。
ただし雇用者数が少なめであり、雇用コストが安く、政府管理が行き届く。

労働者ステータス
生産性　雇用コストおよび一人当たり工場出力に直結。生活水準などに当たる。
満足度　維持コストに直結。富んでいると人余りで一人当たり維持費が高くなっている。貧困だと人不足で一人当たり維持費は低くなっている。
一時的な状態異常値で、適正水準より富んでいるか、適正水準より貧困なのかを表す。



そのほかの職業のメカニクス
############POPメカニクス#################農民####################

生産性と人口、政府管理度に応じて非常にわずかなMAP外工業出力を算出する。維持コストが基本かからない。

工業出力　＝　人口＊生産性＊税率＊国家統合度＊各種補正
農民からの工業力は純粋な税金であり、消費財必要量への影響が基本的にない。
生産性で言えば同レベルの労働者に比べ、産出工業力は圧倒的に低い。
雇用、未雇用の区別はない。
産出　人口＊生産性＊(1-税率)
消費　人口＊生産性＊定数
富裕度はほぼ基礎税率で決定される。あまり豊かにはならない。

各種補正については、国家統合度が重要な役割を果たす。
国家統合度が高いほど、税が効率よく徴収され、人的資源が使用可能になり、生産性の伸び率が高くなり、生産性低下をおくらせる。

生産性変化
国家統合度や教育などが重要。工業力割合、地形も多大な影響を及ぼす。
そもそも劇的に変化せず、プレイヤーの介入の余地が少ない。

農民ステータス
生産性　出力に直結している。あまり多くならず、変化しない。
満足度　出力から諸々を引いた余りが少ないか多いかを示す。
一時的な状態異常を示す。労働者ほど顕著な影響を与えない。



############POPメカニクス#################公務員####################

地域における割合に応じて種々の国家ステータスを上昇させることが可能。
国家統合度、忠誠心、文化転向など
算出はなく、消費しかしない。消費額は完全にプレイヤー操作になる。

公務員コスト　＝　公務員生産性に比例
公務員総コスト　＝　公務員人数＊公務員コスト
富裕度　＝　公務員総コスト/公務員予算
公務員には雇用失業の区別はなく、貧富は平等に負担される。プレイヤーは公務員予算と、そのフォーカスを選べる。
公務員維持費は公務員コストに対するパーセンテージで決定する。このコストは消費財へ加算される。
公務員フォーカスによって、その働きが変わり、効果が変わる。
また、ステートごとに必要に応じて追加予算を投入することができる。これはそのステートの公務員の富裕度をブーストする。

公務員ステータス
生産性　もろもろのステート補正値と維持コストに直結
貧富　維持コストに予算が足りているか余っているかどうかを示す。



############POPメカニクス#################自営業者####################

農民消費＊国家統合度、ステート労働者POP維持コスト、公務員維持費によってステート経済力が形作られ、自営業がこれの恩恵にあずかる。
ほとんど何も算出しないが、人口によってステート経済にボーナスを与える。公務員維持費的に政府によって振興することができる。

生産性からわずかなボーナスを得ることしかできず、自らの生産で自らの生産を支えることができない。
工業力はほとんど算出しないが、各種ステータスを低下することなく維持することができる。工場労働者の失業者の受け皿
あるいは労働者生産性成長に影響したりする。わずかな自国限定投資ポイントも生産する。

維持可能人数；自営業者は何も消費しないが、地元経済の工場、農民、公務員の出力に応じて扶養限界が決まり、扶養限界に至るまで増える。

生産性　もろもろの多少のボーナスを発生させる。
満足度　収入/必要コスト　生産性や移転率に影響する　



############POPメカニクス########投資家#############################

投資家POPは特殊POPであり、国家規模で活動し、ステートごとに分類されない。
労働者、農民出力の一部を吸い出して自動的に開発や建設を行う存在。消費財へと投資家の取り分が加算され、投資家へ分配される。

投資メカニクス　estatesみたいなもの。
投資家は分配された民間工業力を生産性に応じて開発投資ポイントへと変換し、各国へと送り込む。
投入された開発投資ポイントは各国に国ごとに蓄積されていき、
種々の開発のために用いることができる。研究、建設、とか。
個々の開発プロセスはちょびっとランダムだけれど選択の余地があるようにする。
開発をおこなうと、種々の効果が発生し、消費した投資ポイントを所持している国の投資家影響度が上昇したり減少したりする。
基本的には投資家影響度は次第に減少していく。

投資家POP収入
工業力から、各国の投資家影響度に応じて分配され、消費財消費として現れる。
投資家影響度は、投資家ポイントを何に使ったかによって上下する。他のイベントで上下することもある。
各国における投資家用消費財は、投資家の影響度に左右される。

投資家の生産性と充足度
人口と生産性によって、得られた収入のうちいくらを投資ポイントに変換できるかが決まる。多すぎる収入は投資ポイント生産力を上げない。
充足度は、生産性と収入の比で決まる。高い充足度は次第に生産性を上げ、最終的に収入と釣り合う。
逆に収入が低ければ、生産性は下がる。なお、投資ポイント生産の上限は収入依存のため、投資ポイントも減る。



############経済総まとめ#############################
consumer_goods_factorにおいては、国家の軍需＋民需の計算には輸入分も含まれている。
よって、補正値は　欲しい消費財量　/ （軍＋民）（輸入込み）＝　消費財ファクター　となる。

国家基礎出力　８種類の入手方法
軍需工業力　工場＆労働POP、工業流入より
造船工業力　工場＆労働POPより
民需工業力　工場＆労働POP、農民POP、資源輸出代金、工業流入より
資源産出力　資源採掘、資源輸入より
投資家能力　投資家POP、自営業POPより

国家支出　10種類の支出
軍需工業力　装備生産、工業流出
造船工業力　装備生産
民需工業力　労働者：公務員；投資家；POP維持費、資源輸入代金、政府活動、建設
資源産出力　装備生産、資源輸出
投資家能力　投資能力消費

出力詳細

＃工業流入
＃資源輸出代金
＃資源輸入
＃資源採掘
バニラゲームに存在。POPステータスに応じて多少の補正をかけることが可能。

＃工場＆労働POP →軍需、造船、民需、資源
民需、軍需、造船所がそれぞれが最大雇用数を持ち、各工場の最大雇用数を合算、労働者分だけ埋まる。
最大雇用人数＝軍（工場数＊最大雇用数）＋船（工場数＊最大雇用数）＋民（工場数＊雇用数）+資源(資源数＊雇用数)
雇用人数　＝　総労働者POP or 最大雇用人数
実出力＝　雇用者数＊労働POP生産性*modifiers(いろいろ)
max_?_worker 工場最大雇用数　worker_pops労働者POP数　worker_productivity労働者生産性として
max_workers = industrial_complex_level * max_i_worker + arms_factory_level * max_a_worker + docyards_level * max_d_worker+
if = { limit = {worker_pops<max_workers)
actual_workers = worker_pops
}else{
actual_workers = worker_pops
}
local_factories = (productivity * actual_workers / max_workers)*modifiers - 1
のstate_modifierを与える。

＃農民POP
農民の数と農民の生産性、国家統合度、税率そのほか補正の合計によって工業力をわずかに出力し、マップ外工場として提供する。
farmer_factories = farmer_pops*farmer_productivity*modifiers
farmer_factories_change = farmer_factories - last_days_farmer_factories
add_offsite_building　= { type = industrial_complex level = farmer_factories_change } #ただし、現在はこのeffectsはvariablesをサポートしない

＃自営業POP
富裕度(満足度)と人口、生産性に応じて国家投資ポイントを生産する。
daily_investment_points = satisfaction*citizen_pop*productivity*modifiers

＃投資家POP
POP総収入の一部と生産性から国家投資ポイントを生産し、自動配分する。
daily_investment_points = (capitalist_income or pop*productivity)*modifiers


支出詳細

＃装備生産
＃資源輸出
＃工業流出
＃資源輸入代金
＃建設
バニラゲームに存在。POPステータスによって多少の補正はかけられる

＃政府活動
バニラゲームに存在。ただし、地元経済の振興など、多くの特別用途に用いられる。

＃労働者POP維持費
雇用労働者POPへの給料と労働者収支への追加資金に依存する。消費財必要量へと追加。
労働者収支　＝　総労働者POPー雇用労働者POP
雇用労働者賃金　＝　雇用労働者POP＊生産性
労働者収支コスト　＝　労働者収支＊生産性＊追加コスト（失業手当or過剰賃金）　
労働POP総コスト　＝　労働者収支コスト＋雇用労働者賃金
追加コストをそれぞれunemployment_fee, worker_shortage_feeとすると、
total_workers_cost = modifiers* [
actual_workers*productivity*worker_fee + 
(max_workers - actual_workers)*productivity*{(unemployment_fee) or (worker_shortage_fee)}
]

＃公務員POP維持費
公務員予算に完全依存。公務員予算は50%から100%まで取れる。消費財必要量へと追加。
total_admin_pop_cost = productivity*admin_pops*modifiers*(1-government_payment_level)

＃投資家POP維持費
経済影響力に応じて消費財必要割合へと追加される。
total_cap_pop_cost = industrial_influence

最終消費財量の計算
total_consumer_goods = total_workers_cost+total_admin_pop_cost
consumer_goods_factor = total_consumer_goods / (civilian_factories + military_factories) + total_cap_pop_cost

＃投資能力消費
投資ポイントを用いて何か効果をもたらす。
投資ポイントの使い道には、効果のわかっているものと、効果とコストがばくちのものがある。


#####################職業移転と移住、増殖##########################

#################増殖##########################
自然増殖は基本に加えて、満足度と生産性が重要。
高い満足度は増殖を高めるが、高い生産性は増殖を弱める。
充足度 satisfaction 生産性　productivityとすると
growth = modifier*satisfaction/productivity + otherfactor
ただし、そこまで影響がなく、イベントや基本値(otherfactor)の影響が大きい。


################移住と移転##########################

判定と移動の順番は以下の通り、国籍ごとに計算される。
１　ステート内で職業移転判定
２　各職業で国外流出POP、国内移動POP、残留POP割合を決定し、発送
３　国外流出POPを集計、発送先国家を魅力値ごとに計算し、各国へ国外流入POPとして発送
４　国外流入POPを集計、国内移動POPへと合算
５　国内移動POPを集計、発送先ステートを魅力値ごとに計算し、各ステートへ流入POPとして発送
６　各ステートに到着後、流入POPについては職業決定が行われる。

1　職業移転判定
ステートごとに、各POP間で職業移転のやり取りがなされる。
相互に　農民、自営業、労働者、官僚、資本家

２　国外流出、国内移動、残留判定
自ステート魅力値、自国他ステート魅力値、外国魅力値、各ステートの各POPごとに計算され、各方面へ移動する割合がPOPごとに判定される。
各方面へ流出したPOPはその時点で所属POPを失う。
ステートPOPごとに　残留、国内、国外、

３　流出先国家判定
各国家ごとに世界各国に対する魅力値が計算され、国外流出POPが各国へ移動する割合が判定される
流出POP　世界各国へ
資本家POP　自国と世界各国へ

４　国内移動POPの移動先判定合算
各国から来たPOPと国内移動POPを合算し、
国家内部において、各ステートに対する魅力地が計算され、各ステートへ移動するPOP割合が判定される。
流入POPと国内移動POP　各ステートへ

５　国内移動POPの職業判定
ステート内において、各POPの魅力地に応じて所属先が判定される。
ステート流入POP　各職業へ



職業移転判定

各職業ごとに各職業に対する移転率が計算される。おもに富裕度と生産性が考慮される。

農民		↑労働者	↑自営業	↑公務員
労働者	↓農民		→自営業	→公務員	↑投資家
自営業	↓農民	→労働者		→公務員	↑投資家
公務員	↓農民	→労働者	→自営業		↑投資家
投資家		↓労働者	↓自営業	↓公務員

という形。上矢印はpromotion、下矢印はdemotion、横矢印はただの移動。



############POPメカニクス########生産性変化と効果#############################

生産性の解釈。各地域の労働者の生産性は個々人の能力というより周囲の環境に依存するものと考える
生産性変化において重要なのは、富裕度、地域補正。
人口増減は直接は影響しない。ただし人口増減は満足度に影響し、それによって生産性が落ちる。


労働者

自営業

公務員

農民


投資家




###########ステート管理画面設計方針###############

ステート基本画面
　基本の画面、最終工場数や統合度など、いくつかの新機能を追加する。

ステートPOP詳細画面
　詳細画面、ステートのPOPの状況把握はここで行う。ステートにおける移民と人口変動詳細も見れる。

ステートPOP、国家POP一括管理画面
　ステートをリストで一覧でき、ステートやそこのPOPの基礎情報をみて、そのステートへと移動できる
　投資家POPについて詳細が見れる。人口流入と流出の詳細も見れる。

国家移民管理画面
　移民について主に国外流出と国内流入の情報を把握し、管理できる

国内投資画面
　投資ポイントの管理を行う。各国からの投資と影響度などがリストになっており、その使い道を決定する。

対外投資画面
　外国への投資ポイント管理を行う。各国における自国の影響度と影響率などがリストになっている。
　十分な影響度を持ち、いくつかの条件がそろえば特殊な行動を起こせる。

ハイライト機能はディシジョン限定か？
このインターフェイスを早期試作したい。
league of nationsのリストはダイナミックではないので、MtGを待つ。BLACKICEにおいてダイナミック画面が存在する。どう実現してるか調べよう


民間投資管理画面











